<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>14 De-duplication | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome - THIS IS A DRAFT</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">4</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">5</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">6</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">7</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">9</span> Factors</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">11</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">12</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">13</span> Characters and strings</a></li>
<li><a class="active" href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="iteration-and-loops.html"><span class="header-section-number">15</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">16</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">17</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">18</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">19</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">20</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">21</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">22</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">23</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">24</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">25</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">26</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">27</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">28</span> Plot categorical data</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">29</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">30</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">31</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">32</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">33</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">34</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">35</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">36</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">37</span> Errors &amp; warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">38</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">39</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">40</span> Routine reports</a></li>
<li><a class="" href="r-markdown-1.html"><span class="header-section-number">41</span> R Markdown</a></li>
<li><a class="" href="shiny-and-dashboards.html"><span class="header-section-number">42</span> Shiny and dashboards</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">43</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">45</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">46</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="de-duplication" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> De-duplication<a class="anchor" aria-label="anchor" href="#de-duplication"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/deduplication2.png" width="50%"></div>
<!-- ======================================================= -->
<div id="overview-7" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-7"><i class="fas fa-link"></i></a>
</h2>
<p>This page covers the following subjects:</p>
<ol style="list-style-type: decimal">
<li>Identifying and removing duplicate rows<br>
</li>
<li>“Slicing” and keeping only certain rows (min, max, random…), also from each group<br>
</li>
<li>“Rolling-up”, or combining values from multiple rows into one</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="preparation-6" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-6"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Load packages</strong></p>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,   <span class="co"># deduplication, grouping, and slicing functions</span>
  <span class="va">janitor</span>,     <span class="co"># function for reviewing duplicates</span>
  <span class="va">stringr</span><span class="op">)</span>      <span class="co"># for string searches, can be used in "rolling-up" values</span></code></pre></div>
<p><strong>Example dataset</strong></p>
<p>For demonstration, we will use the fake dataset below. It is a record of COVID-19 phone encounters, including with contacts and with cases.</p>
<ul>
<li>The first two records are 100% complete duplicates including duplicate <code>recordID</code> (computer glitch)<br>
</li>
<li>The second two rows are duplicates, in all columns <em>except for <code>recordID</code></em><br>
</li>
<li>Several people had multiple phone encounters, at various dates/times and as contacts or cases<br>
</li>
<li>At each encounter, the person was asked if they had <strong>ever</strong> had symptoms, and some of this information is missing.</li>
</ul>
<p>Here is the code to create the dataset:</p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  recordID  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">17</span>,<span class="fl">18</span><span class="op">)</span>,
  personID  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span>,
  name      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"adam"</span>, <span class="st">"adam"</span>, <span class="st">"amrish"</span>, <span class="st">"amrish"</span>, <span class="st">"mariah"</span>, <span class="st">"amrish"</span>, <span class="st">"nikhil"</span>, <span class="st">"brian"</span>, <span class="st">"smita"</span>, <span class="st">"raquel"</span>, <span class="st">"amrish"</span>,
                <span class="st">"adam"</span>, <span class="st">"mariah"</span>, <span class="st">"mariah"</span>, <span class="st">"nikhil"</span>, <span class="st">"brian"</span>, <span class="st">"brian"</span>, <span class="st">"raquel"</span>, <span class="st">"natalie"</span><span class="op">)</span>,
  date      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1/1/2020"</span>, <span class="st">"1/1/2020"</span>, <span class="st">"2/1/2020"</span>, <span class="st">"2/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>,<span class="st">"5/1/2020"</span>, <span class="st">"2/1/2020"</span>,
                <span class="st">"5/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"7/1/2020"</span>, <span class="st">"7/1/2020"</span>, <span class="st">"7/1/2020"</span><span class="op">)</span>,
  time      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"09:00"</span>, <span class="st">"09:00"</span>, <span class="st">"14:20"</span>, <span class="st">"14:20"</span>, <span class="st">"12:00"</span>, <span class="st">"16:10"</span>, <span class="st">"13:01"</span>, <span class="st">"15:20"</span>, <span class="st">"14:20"</span>, <span class="st">"12:30"</span>, <span class="st">"10:24"</span>,
                <span class="st">"09:40"</span>, <span class="st">"07:25"</span>, <span class="st">"08:32"</span>, <span class="st">"15:36"</span>, <span class="st">"15:31"</span>, <span class="st">"07:59"</span>, <span class="st">"11:13"</span>, <span class="st">"17:12"</span><span class="op">)</span>,
  encounter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,
                <span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,
  purpose   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span>, <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>,
                <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span><span class="op">)</span>,
  symptoms_ever <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>, <span class="st">"Yes"</span>,
                    <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>,<span class="st">"No"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And here is the dataset:</p>
<div id="htmlwidget-d920584abc62b89ad14f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d920584abc62b89ad14f">{"x":{"filter":"none","data":[[1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,1,2,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","adam","amrish","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["1/1/2020","1/1/2020","2/1/2020","2/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","2/1/2020","5/1/2020","6/1/2020","6/1/2020","6/1/2020","6/1/2020","7/1/2020","7/1/2020","7/1/2020"],["09:00","09:00","14:20","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,null,"No","No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,19,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="deduplication-1" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Deduplication<a class="anchor" aria-label="anchor" href="#deduplication-1"><i class="fas fa-link"></i></a>
</h2>
<p>This tab uses the dataset from the Preparation tab to describe how to review and remove duplicate rows in a dataframe. It also show how to handle duplicate elements in a vector.</p>
<!-- ======================================================= -->
<div id="examine-duplicate-rows" class="section level3 unnumbered">
<h3>Examine duplicate rows<a class="anchor" aria-label="anchor" href="#examine-duplicate-rows"><i class="fas fa-link"></i></a>
</h3>
<p>To quickly review rows that have duplicates, you can use <code>get_dupes()</code> from the <strong>janitor</strong> package. <em>By default</em>, all columns are considered when duplicates are evaluated - rows returned are 100% duplicates considering the values in <em>all</em> columns.</p>
<p>In the <code>obs</code> dataframe, the first two rows are <em>100% duplicates</em> - they have the same value in every column (including the <code>recordID</code> column, which is <em>supposed</em> to be unique - it must be some computer glitch). The returned dataframe automatically includes a new column <code>dupe_count</code>, showing the number of rows with that combination of duplicate values.</p>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 100% duplicates across all columns</span>
<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a9aef565ca96de944b54" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a9aef565ca96de944b54">{"x":{"filter":"none","data":[[1,1],[1,1],["adam","adam"],["1/1/2020","1/1/2020"],["09:00","09:00"],[1,1],["contact","contact"],[null,null],[2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>dupe_count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,19,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>However, if we choose to ignore <code>recordID</code>, the 3rd and 4th rows rows are also duplicates of each other. That is, they have the same values in all columns <em>except</em> for <code>recordID</code>. You can specify specific columns to be ignored in the function using a <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> minus symbol.</p>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Duplicates when column recordID is not considered</span>
<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="op">-</span><span class="va">recordID</span><span class="op">)</span>         <span class="co"># if multiple columns, wrap them in c()</span></code></pre></div>
<div id="htmlwidget-a2eeb6e153e6889efe1d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a2eeb6e153e6889efe1d">{"x":{"filter":"none","data":[[1,1,2,2],["adam","adam","amrish","amrish"],["1/1/2020","1/1/2020","2/1/2020","2/1/2020"],["09:00","09:00","14:20","14:20"],[1,1,1,1],["contact","contact","contact","contact"],[null,null,"No","No"],[2,2,2,2],[1,1,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>dupe_count<\/th>\n      <th>recordID<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,4,7,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,19,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>You can also positively specify the columns to consider. Below, only rows that have the same values in the <code>name</code> and <code>purpose</code> columns are returned. Notice how “amrish” now has <code>dupe_count</code> equal to 3 to reflect his three “contact” encounters.</p>
<p>*Scroll left for more rows**</p>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># duplicates based on name and purpose columns ONLY</span>
<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">purpose</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-ec42eabdadd5589f210d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ec42eabdadd5589f210d">{"x":{"filter":"none","data":[["adam","adam","amrish","amrish","amrish","brian","brian","mariah","mariah","nikhil","nikhil","raquel","raquel"],["contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact"],[2,2,3,3,3,2,2,2,2,2,2,2,2],[1,1,2,3,10,7,15,12,13,6,14,9,17],[1,1,2,2,2,5,5,3,3,4,4,7,7],["1/1/2020","1/1/2020","2/1/2020","2/1/2020","2/1/2020","5/1/2020","6/1/2020","6/1/2020","6/1/2020","5/1/2020","6/1/2020","5/1/2020","7/1/2020"],["09:00","09:00","14:20","14:20","10:24","15:20","15:31","07:25","08:32","13:01","15:36","12:30","11:13"],[1,1,1,1,2,1,2,2,3,1,2,1,2],[null,null,"No","No","Yes","No","Yes","No","No","Yes","Yes",null,"No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>name<\/th>\n      <th>purpose<\/th>\n      <th>dupe_count<\/th>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>See <code>?get_dupes</code> for more details, or see this <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes">online reference</a></p>
<!-- ======================================================= -->
</div>
<div id="keep-only-unique-rows" class="section level3 unnumbered">
<h3>Keep only unique rows<a class="anchor" aria-label="anchor" href="#keep-only-unique-rows"><i class="fas fa-link"></i></a>
</h3>
<p>To keep only unique rows of a dataframe, use <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> from <strong>dplyr</strong>. Rows that are duplicates are removed such that only the first of such rows is kept. By default, “first” means the highest <code>rownumber</code> (order of rows top-to-bottom). Only unique rows are kept. In the example below, <strong>one duplicate row (the first row, for “adam”) has been removed</strong> (n is now 18, not 19 rows).</p>
<p><em>Scroll to the left to see the entire dataframe</em></p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># added to a chain of pipes (e.g. data cleaning)</span>
<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="op">-</span><span class="va">recordID</span><span class="op">)</span>, <span class="co"># reduces dataframe to only unique rows (keeps first one of any duplicates)</span>
           .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 

<span class="co"># if outside pipes, include the data as first argument </span>
<span class="co"># distinct(obs)</span></code></pre></div>
<div id="htmlwidget-61afad5c1bf76d4f46db" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-61afad5c1bf76d4f46db">{"x":{"filter":"none","data":[[1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["1/1/2020","2/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","2/1/2020","5/1/2020","6/1/2020","6/1/2020","6/1/2020","6/1/2020","7/1/2020","7/1/2020","7/1/2020"],["09:00","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,"No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If using <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> on grouped data, the function will apply to each group.</span></p>
<p><strong>Deduplicate based on specific columns</strong></p>
<p>You can also specify columns to be the basis for de-duplication. In this way, the de-duplication only applies to rows that are duplicates within the specified columns. Unless specified with <code>.keep_all = TRUE</code>, all columns not mentioned will be dropped.</p>
<p>In the example below, the de-duplication only applies to rows that have identical values for <code>name</code> and <code>purpose</code> columns. Thus, “brian” has only 2 rows instead of 3 - his <em>first</em> “contact” encounter and his only “case” encounter. To adjust so that brian’s <em>latest</em> encounter of each purpose is kept, see the tab on Slicing within groups.</p>
<p><em>Scroll to the left to see the entire dataframe</em></p>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># added to a chain of pipes (e.g. data cleaning)</span>
<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">purpose</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># keep rows unique by name and purpose, retain all columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>                                  <span class="co"># arrange for easier viewing</span></code></pre></div>
<div id="htmlwidget-45bb42d66895a724b4fa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-45bb42d66895a724b4fa">{"x":{"filter":"none","data":[[1,11,2,5,7,16,4,12,18,6,9,8],[1,1,2,2,5,5,3,3,8,4,7,6],["adam","adam","amrish","amrish","brian","brian","mariah","mariah","natalie","nikhil","raquel","smita"],["1/1/2020","5/1/2020","2/1/2020","5/1/2020","5/1/2020","7/1/2020","5/1/2020","6/1/2020","7/1/2020","5/1/2020","5/1/2020","5/1/2020"],["09:00","09:40","14:20","16:10","15:20","07:59","12:00","07:25","17:12","13:01","12:30","14:20"],[1,2,1,3,1,3,1,2,1,1,1,1],["contact","case","contact","case","contact","case","case","contact","case","contact","contact","contact"],[null,"No","No","Yes","No","No","No","No","No","Yes",null,"Yes"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="duplicate-elements-in-a-vector" class="section level3 unnumbered">
<h3>Duplicate elements in a vector<a class="anchor" aria-label="anchor" href="#duplicate-elements-in-a-vector"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> from <strong>base</strong> R will evaluate a vector (column) and return a logical vector of the same length (TRUE/FALSE). The first time a value appears, it will return FALSE (not a duplicate), and subsequent times that value appears it will return TRUE. Note how <code>NA</code> is treated the same as any other value.</p>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
<p>To return only the duplicated elements, you can use brackets to subset the original vector:</p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>## [1]  1 NA  4  4  1  2</code></pre>
<p>To return only the unique elements, use <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> from <strong>base</strong> R. To remove <code>NA</code>s from the output, nest <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> within <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>.</p>
<div class="sourceCode" id="cb655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>           <span class="co"># alternatively, use x[!duplicated(x)]</span></code></pre></div>
<pre><code>## [1]  1  2 NA  4  5</code></pre>
<div class="sourceCode" id="cb657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove NAs </span></code></pre></div>
<pre><code>## [1] 1 2 4 5</code></pre>
<!-- ======================================================= -->
</div>
<div id="with-base-r" class="section level3 unnumbered">
<h3>with <strong>base</strong> R<a class="anchor" aria-label="anchor" href="#with-base-r"><i class="fas fa-link"></i></a>
</h3>
<p><strong>To return duplicate rows</strong></p>
<p>In <strong>base</strong> R, you can also see which rows are 100% duplicates in a dataframe <code>df</code> with the command <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated(df)</a></code> (returns a logical vector of the rows).</p>
<p>Thus, you can also use the base subset <code>[ ]</code> on the dataframe to see the <em>duplicated</em> rows with <code>df[duplicated(df),]</code> (don’t forget the comma, meaning that you want to see all columns!).</p>
<p><strong>To return unique rows</strong></p>
<p>See the notes above. To see the <em>unique</em> rows you add the logical negator <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> in front of the <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> function:<br><code>df[!duplicated(df),]</code></p>
<p><strong>To return rows that are duplicates of only certain columns</strong></p>
<p>Subset the <code>df</code> that is <em>within the <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> parentheses</em>, so this function will operate on only certain columns of the <code>df</code>.</p>
<p>To specify the columns, provide column numbers or names after a comma (remember, all this is <em>within</em> the <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> function).</p>
<p>Be sure to keep the comma <code>,</code> <em>outside</em> after the <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> function as well!</p>
<p>For example, to evaluate only columns 2 through 5 for duplicates: <code>df[!duplicated(df[, 2:5]),]</code><br>
To evaluate only columns <code>name</code> and <code>purpose</code> for duplicates: <code>df[!duplicated(df[, c("name", "purpose)]),]</code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="slicing" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Slicing<a class="anchor" aria-label="anchor" href="#slicing"><i class="fas fa-link"></i></a>
</h2>
<p>To “slice” a dataframe is useful in de-duplication if you have multiple rows per functional group (e.g. per “person”) and you only want to analyze one or some of them. Think of slicing as a filter on the rows, by row number/position.</p>
<p><strong>The basic <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> function</strong> accepts a number <code>n</code>. If positive, only the <em>nth</em> row is returned. If negative, all rows <em>except the nth</em> are returned.</p>
<p><strong>Variations</strong> include:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> - to keep only the row with the minimium or maximum value of the specified column. Also worked with ordered factors.<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code> and <code>slice_tail</code> - to keep only the <em>first</em> or <em>last</em> row<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> - to keep only a random sample of the rows</li>
</ul>
<p>Use arguments <code>n =</code> or <code>prop =</code> to specify the number or proportion of rows to keep. If not using the function in a pipe chain, provide the data argument first (e.g. <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice(df, n = 2)</a></code>). See <code><a href="https://dplyr.tidyverse.org/reference/slice.html">?slice</a></code> for more information.</p>
<p>Other arguments:</p>
<p><code>.order_by =</code> used in <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> this is a column to order by before slicing.<br><code>with_ties =</code> TRUE by default, meaning ties are kept.<br><code>.preserve =</code> FALSE by default. If TRUE then the grouping structure is re-calculated after slicing.<br><code>weight_by =</code> Optional, numeric column to weight by (bigger number more likely to get sampled). Also <code>replace =</code> for whether sampling is done with/without replacement.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> When using <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code>, be sure to specify/write the <code>n =</code> (e.g. <code>n = 2</code>, not just <code>2</code>). Otherwise you may get an error <code>Error:</code>…<code>is not empty.</code> </span></p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> You may encounter the function <a href="https://dplyr.tidyverse.org/reference/top_n.html"><code>top_n()</code></a>, which has been superseded by the <code>slice</code> functions.</span></p>
<p>Here, the basic <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> function is used to keep only the 4th row:</p>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>  <span class="co"># keeps the 4th row only</span></code></pre></div>
<div id="htmlwidget-a1967fd7a37f3ba830f9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a1967fd7a37f3ba830f9">{"x":{"filter":"none","data":[[3],[2],["amrish"],["2/1/2020"],["14:20"],[1],["contact"],["No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":1,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= --><div id="slice-with-groups" class="section level3 unnumbered">
<h3>Slice with groups<a class="anchor" aria-label="anchor" href="#slice-with-groups"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>slice_*()</code> functions can be very useful if applied to a grouped dataframe, as the slice operation is performed on each group separately. Use the <strong>function</strong> <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> in conjunction with <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> to group the data and then take a slice from each group.</p>
<p>This is helpful for de-duplication if you have multiple rows per person but only want to keep one of them. You first use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> with key columns that are the same, and then use a slice function on a column that will differ among the grouped rows.</p>
<p>In the example below, to keep only the <em>latest</em> encounter <em>per person</em>, we group the rows by <code>name</code> and then use <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> with <code>n = 1</code> on the <code>date</code> column. Be aware! To apply a function like <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> on dates, the date column must be class Date.</p>
<p>By default, “ties” (e.g. same date in this scenario) are kept, and we would still get multiple rows for some people (e.g. adam). To avoid this we set <code>with_ties = FALSE</code>. We get back only one row per person.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If using <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, specify <code>.by_group = TRUE</code> to have the data arranged within each group.</span></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> If <code>with_ties = FALSE</code>, the first row of a tie is kept. This may be deceptive. See how for Mariah, she has two encounters on her latest date (6 Jan) and the first (earliest) one was kept. Likely, we want to keep her later encounter on that day. See how to “break” these ties in the next example. </span></p>
<div class="sourceCode" id="cb660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span>       <span class="co"># group the rows by 'name'</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">date</span>,          <span class="co"># keep row per group with maximum date value </span>
            n <span class="op">=</span> <span class="fl">1</span>,         <span class="co"># keep only the single highest row </span>
            with_ties <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># if there's a tie (of date), take the first row</span></code></pre></div>
<div id="htmlwidget-3c126d03527cf88f9041" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3c126d03527cf88f9041">{"x":{"filter":"none","data":[[11,5,16,12,18,14,17,8],[1,2,5,3,8,4,7,6],["adam","amrish","brian","mariah","natalie","nikhil","raquel","smita"],["5/1/2020","5/1/2020","7/1/2020","6/1/2020","7/1/2020","6/1/2020","7/1/2020","5/1/2020"],["09:40","16:10","07:59","07:25","17:12","15:36","11:13","14:20"],[2,3,3,2,1,2,2,1],["case","case","case","contact","case","contact","contact","contact"],["No","Yes","No","No","No","Yes","No","Yes"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Breaking “ties”</strong></p>
<p>Multiple slice statements can be run to “break ties”. In this case, if a person has multiple encounters on their latest <em>date</em>, the encounter with the latest <em>time</em> is kept (<code><a href="http://lubridate.tidyverse.org/reference/hms.html">lubridate::hm()</a></code> is used to convert the character times to a sortable time class).<br>
Note how now, the one row kept for “Mariah” on 6 Jan is encounter 3 from 08:32, not encounter 2 at 07:25.</p>
<div class="sourceCode" id="cb661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Example of multiple slice statements to "break ties"</span>
<span class="va">obs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># FIRST - slice by latest date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">date</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># SECOND - if there is a tie, select row with latest time; ties prohibited</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/hms.html">hm</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-82bce596e1aefc912db5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-82bce596e1aefc912db5">{"x":{"filter":"none","data":[[11,5,16,13,18,14,17,8],[1,2,5,3,8,4,7,6],["adam","amrish","brian","mariah","natalie","nikhil","raquel","smita"],["5/1/2020","5/1/2020","7/1/2020","6/1/2020","7/1/2020","6/1/2020","7/1/2020","5/1/2020"],["09:40","16:10","07:59","08:32","17:12","15:36","11:13","14:20"],[2,3,3,3,1,2,2,1],["case","case","case","contact","case","contact","contact","contact"],["No","Yes","No","No","No","Yes","No","Yes"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><em>In the example above, it would also have been possible to slice by <code>encounter</code> number, but we showed the slice on <code>date</code> and <code>time</code> for example purposes.</em></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> To use <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> on a “character” column, mutate it to an <em>ordered</em> factor class!</span></p>
<!-- ======================================================= -->
</div>
<div id="keep-all-but-mark-them" class="section level3 unnumbered">
<h3>Keep all but mark them<a class="anchor" aria-label="anchor" href="#keep-all-but-mark-them"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to keep all records but mark only some for analysis, consider a two-step approach utilizing a unique recordID/encounter number:</p>
<ol style="list-style-type: decimal">
<li>Reduce/slice the orginal dataframe to only the rows for analysis. Save/retain this reduced dataframe.<br>
</li>
<li>In the original dataframe, mark rows as appropriate with <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, based on whether their record unique identifier (recordID in this example) is present in the reduced dataframe.</li>
</ol>
<div class="sourceCode" id="cb662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 1. Define dataframe of rows to keep for analysis</span>
<span class="va">obs_keep</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">encounter</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># keep only latest encounter per person</span>


<span class="co"># 2. Mark original dataframe</span>
<span class="va">obs_marked</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op">%&gt;%</span>

  <span class="co"># make new dup_record column</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dup_record <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    
    <span class="co"># if record is in obs_keep dataframe</span>
    <span class="va">recordID</span> <span class="op">%in%</span> <span class="va">obs_keep</span><span class="op">$</span><span class="va">recordID</span> <span class="op">~</span> <span class="st">"For analysis"</span>, 
    
    <span class="co"># all else marked as "Ignore" for analysis purposes</span>
    <span class="cn">TRUE</span>                            <span class="op">~</span> <span class="st">"Ignore"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># print</span>
<span class="va">obs_marked</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="calculate-row-completeness" class="section level3 unnumbered">
<h3>Calculate row completeness<a class="anchor" aria-label="anchor" href="#calculate-row-completeness"><i class="fas fa-link"></i></a>
</h3>
<p>Create a column that contains a metric for the row’s completeness (non-missingness). This could be helpful when deciding which rows to prioritize over others when de-duplicating/slicing.</p>
<p>In this example, “key” columns over which you want to measure completeness are saved in a vector of column names.</p>
<p>Then the new column <code>key_completeness</code> is created with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. The new value in each row is defined as a calculated fraction: the number of non-missing values in that row among the key columns, divided by the number of key columns.</p>
<p>This involves the function <code><a href="https://rdrr.io/r/base/colSums.html">rowSums()</a></code> from <strong>base</strong> R. Also used is <code>.</code>, which within piping refers to the dataframe at that point in the pipe (in this case, it is being subset with brackets <code>[]</code>).</p>
<p>*Scroll to the right to see more rows**</p>
<div class="sourceCode" id="cb663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a "key variable completeness" column</span>
<span class="co"># this is a *proportion* of the columns designated as "key_vars" that have non-missing values</span>

<span class="va">key_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"personID"</span>, <span class="st">"name"</span>, <span class="st">"symptoms_ever"</span><span class="op">)</span>

<span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>key_completeness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="va">key_cols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">key_cols</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div id="htmlwidget-ddc34df56ea0d2ef0135" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ddc34df56ea0d2ef0135">{"x":{"filter":"none","data":[[1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,1,2,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","adam","amrish","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["1/1/2020","1/1/2020","2/1/2020","2/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","5/1/2020","2/1/2020","5/1/2020","6/1/2020","6/1/2020","6/1/2020","6/1/2020","7/1/2020","7/1/2020","7/1/2020"],["09:00","09:00","14:20","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,null,"No","No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"],[0.666666666666667,0.666666666666667,1,1,1,1,1,1,1,0.666666666666667,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>key_completeness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="roll-up-values" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Roll-up values<a class="anchor" aria-label="anchor" href="#roll-up-values"><i class="fas fa-link"></i></a>
</h2>
<p>This section describes:</p>
<ol style="list-style-type: decimal">
<li>How to “roll-up” values from multiple rows into just one row, with some variations<br>
</li>
<li>Once you have “rolled-up” values, how to overwrite/prioritize the values in each cell</li>
</ol>
<p>This tab uses the example dataset from the Preparation tab.</p>
<!-- ======================================================= -->
<div id="roll-up-values-into-one-row" class="section level3 unnumbered">
<h3>Roll-up values into one row<a class="anchor" aria-label="anchor" href="#roll-up-values-into-one-row"><i class="fas fa-link"></i></a>
</h3>
<p>The code example below uses <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> to group rows by person, and then paste together all unique values within the grouped rows. Thus, you get one summary row per person. A few notes:</p>
<ul>
<li>A suffix is appended to all new columns ("_roll" in this example)<br>
</li>
<li>If you want to show only unique values per cell, then wrap the <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> with <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code><br>
</li>
<li>
<code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> removes <code>NA</code> values, but if this is not desired it can be removed <code><a href="https://rdrr.io/r/base/paste.html">paste0(.x)</a></code>…</li>
</ul>
<p><em>Scroll to the left to see more rows</em></p>
<div class="sourceCode" id="cb664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># "Roll-up" values into one row per group (per "personID") </span>
<span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># create groups by name</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># order the rows within each group (e.g. by date)</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># For each column, paste together all values within the grouped rows, separated by ";"</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                           <span class="co"># apply to all columns</span>
           <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># function is defined which combines non-NA values</span></code></pre></div>
<p>The result is one row per group (<code>ID</code>), with entries arranged by date and pasted together.</p>
<div id="htmlwidget-b60055d85de47f22f2d8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b60055d85de47f22f2d8">{"x":{"filter":"none","data":[[1,2,3,4,5,6,7,8],["1; 1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam; adam; adam","amrish; amrish; amrish; amrish","mariah; mariah; mariah","nikhil; nikhil","brian; brian; brian","smita","raquel; raquel","natalie"],["1/1/2020; 1/1/2020; 5/1/2020","2/1/2020; 2/1/2020; 2/1/2020; 5/1/2020","5/1/2020; 6/1/2020; 6/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020; 7/1/2020","5/1/2020","5/1/2020; 7/1/2020","7/1/2020"],["09:00; 09:00; 09:40","14:20; 14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 1; 2","1; 1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; contact; case","contact; contact; contact; case","case; contact; contact","contact; contact","contact; contact; case","contact","contact; contact","case"],["No","No; No; Yes; Yes","No; No; No","Yes; Yes","No; Yes; No","Yes","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>This variation shows unique values only:</strong></p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Variation - show unique values only </span>
<span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                                   <span class="co"># apply to all columns</span>
           <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># function is defined which combines unique non-NA values</span></code></pre></div>
<div id="htmlwidget-1cc0dde37fe663c8713c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1cc0dde37fe663c8713c">{"x":{"filter":"none","data":[[1,2,3,4,5,6,7,8],["1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam","amrish","mariah","nikhil","brian","smita","raquel","natalie"],["1/1/2020; 5/1/2020","2/1/2020; 5/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020; 7/1/2020","5/1/2020","5/1/2020; 7/1/2020","7/1/2020"],["09:00; 09:40","14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 2","1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; case","contact; case","case; contact","contact","contact; case","contact","contact","case"],["No","No; Yes","No","Yes","No; Yes","Yes","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>This variation appends a suffix to each column.</strong><br>
In this case "_roll" to signify that it has been rolled:</p>
<div class="sourceCode" id="cb666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Variation - suffix added to column names </span>
<span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                
           <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>roll <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># _roll is appended to column names</span></code></pre></div>
<div id="htmlwidget-4da593733343d8d892a5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4da593733343d8d892a5">{"x":{"filter":"none","data":[[1,2,3,4,5,6,7,8],["1; 1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam; adam; adam","amrish; amrish; amrish; amrish","mariah; mariah; mariah","nikhil; nikhil","brian; brian; brian","smita","raquel; raquel","natalie"],["1/1/2020; 1/1/2020; 5/1/2020","2/1/2020; 2/1/2020; 2/1/2020; 5/1/2020","5/1/2020; 6/1/2020; 6/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020; 7/1/2020","5/1/2020","5/1/2020; 7/1/2020","7/1/2020"],["09:00; 09:00; 09:40","14:20; 14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 1; 2","1; 1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; contact; case","contact; contact; contact; case","case; contact; contact","contact; contact","contact; contact; case","contact","contact; contact","case"],["No","No; No; Yes; Yes","No; No; No","Yes; Yes","No; Yes; No","Yes","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID_roll<\/th>\n      <th>name_roll<\/th>\n      <th>date_roll<\/th>\n      <th>time_roll<\/th>\n      <th>encounter_roll<\/th>\n      <th>purpose_roll<\/th>\n      <th>symptoms_ever_roll<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="overwrite-valueshierarchy" class="section level3 unnumbered">
<h3>Overwrite values/hierarchy<a class="anchor" aria-label="anchor" href="#overwrite-valueshierarchy"><i class="fas fa-link"></i></a>
</h3>
<p>If you then want to evaluate all of the rolled values, and keep only a specific value (e.g. “best” or “maximum” value), you can use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> across the desired columns, to implement <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, which uses <code>str_detect()</code> from the <strong>stringr</strong> package to sequentially look for string patterns and overwrite the cell content.</p>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEAN CASES</span>
<span class="co">#############</span>
<span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases_rolled</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean Yes-No-Unknown vars: replace text with "highest" value present in the string</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"symptoms_ever"</span><span class="op">)</span><span class="op">)</span>,                     <span class="co"># operates on specified columns (Y/N/U)</span>
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>                                 <span class="co"># adds suffix "_mod" to new cols; implements case_when()</span>
               
               <span class="fu">str_detect</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Yes"</span><span class="op">)</span>       <span class="op">~</span> <span class="st">"Yes"</span>,                 <span class="co"># if "Yes" is detected, then cell value converts to yes</span>
               <span class="fu">str_detect</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"No"</span><span class="op">)</span>        <span class="op">~</span> <span class="st">"No"</span>,                  <span class="co"># then, if "No" is detected, then cell value converts to no</span>
               <span class="fu">str_detect</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Unknown"</span><span class="op">)</span>   <span class="op">~</span> <span class="st">"Unknown"</span>,             <span class="co"># then, if "Unknown" is detected, then cell value converts to Unknown</span>
               <span class="cn">TRUE</span>                        <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,   <span class="co"># then, if anything else if it kept as is</span>
      .keep <span class="op">=</span> <span class="st">"unused"</span><span class="op">)</span>                                             <span class="co"># old columns removed, leaving only _mod columns</span></code></pre></div>
<p>Now you can see in the column <code>symptoms_ever</code> that if the person EVER said “Yes” to symptoms, then only “Yes” is displayed.</p>
<div id="htmlwidget-55e70ac7a72893ab9c3b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-55e70ac7a72893ab9c3b">{"x":{"filter":"none","data":[[1,2,3,4,5,6,7,8],["1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam","amrish","mariah","nikhil","brian","smita","raquel","natalie"],["1/1/2020; 5/1/2020","2/1/2020; 5/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020","5/1/2020; 6/1/2020; 7/1/2020","5/1/2020","5/1/2020; 7/1/2020","7/1/2020"],["09:00; 09:40","14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 2","1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; case","contact; case","case; contact","contact","contact; case","contact","contact","case"],["No","Yes","No","Yes","Yes","Yes","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever_mod<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="probabilistic-de-duplication" class="section level2" number="14.6">
<h2>
<span class="header-section-number">14.6</span> Probabilistic de-duplication<a class="anchor" aria-label="anchor" href="#probabilistic-de-duplication"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, you may want to identify “likely” duplicates based on similarity (e.g. string “distance”) across several columns such as name, age, sex, date of birth, etc. You can apply a probabilistic matching algorithm to identify likely duplicates.</p>
<p>See the page on <a href="joining-data.html#joining-data">Joining data</a> for an explanation on this method. The section on Probabilistic Matching contains an example of applying these algorithms to compare a dataframe to <em>itself</em>, thus performing probabilistic de-duplication.</p>
<!-- ======================================================= -->
</div>
<div id="resources-7" class="section level2" number="14.7">
<h2>
<span class="header-section-number">14.7</span> Resources<a class="anchor" aria-label="anchor" href="#resources-7"><i class="fas fa-link"></i></a>
</h2>
<p>Much of the information in this page is adapted from these resources and vignettes online:</p>
<p><a href="https://www.datanovia.com/en/lessons/identify-and-remove-duplicate-data-in-r/">datanovia</a></p>
<p><a href="https://dplyr.tidyverse.org/reference/slice.html">dplyr tidyverse reference</a></p>
<p><a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes">cran janitor vignette</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="characters-and-strings.html"><span class="header-section-number">13</span> Characters and strings</a></div>
<div class="next"><a href="iteration-and-loops.html"><span class="header-section-number">15</span> Iteration and loops</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#de-duplication"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="nav-link" href="#overview-7"><span class="header-section-number">14.1</span> Overview</a></li>
<li><a class="nav-link" href="#preparation-6"><span class="header-section-number">14.2</span> Preparation</a></li>
<li>
<a class="nav-link" href="#deduplication-1"><span class="header-section-number">14.3</span> Deduplication</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#examine-duplicate-rows">Examine duplicate rows</a></li>
<li><a class="nav-link" href="#keep-only-unique-rows">Keep only unique rows</a></li>
<li><a class="nav-link" href="#duplicate-elements-in-a-vector">Duplicate elements in a vector</a></li>
<li><a class="nav-link" href="#with-base-r">with base R</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#slicing"><span class="header-section-number">14.4</span> Slicing</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#slice-with-groups">Slice with groups</a></li>
<li><a class="nav-link" href="#keep-all-but-mark-them">Keep all but mark them</a></li>
<li><a class="nav-link" href="#calculate-row-completeness">Calculate row completeness</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#roll-up-values"><span class="header-section-number">14.5</span> Roll-up values</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#roll-up-values-into-one-row">Roll-up values into one row</a></li>
<li><a class="nav-link" href="#overwrite-valueshierarchy">Overwrite values/hierarchy</a></li>
</ul>
</li>
<li><a class="nav-link" href="#probabilistic-de-duplication"><span class="header-section-number">14.6</span> Probabilistic de-duplication</a></li>
<li><a class="nav-link" href="#resources-7"><span class="header-section-number">14.7</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
