<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>27 ggplot tips | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">5</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">7</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-and-loops.html"><span class="header-section-number">16</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">17</span> Descriptive analysis</a></li>
<li><a class="" href="univariate-and-multivariate-regression.html"><span class="header-section-number">18</span> Univariate and multivariate regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">19</span> Missing data</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">20</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">21</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">22</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">23</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">24</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">25</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">26</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="active" href="ggplot-tips.html"><span class="header-section-number">27</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">28</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">29</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">30</span> Plot categorical data</a></li>
<li><a class="" href="tables-1.html"><span class="header-section-number">31</span> Tables</a></li>
<li><a class="" href="age-pyramids-and-likert-scales.html"><span class="header-section-number">32</span> Age pyramids and Likert-scales</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">33</span> Diagrams</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">34</span> Combinations analysis</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">35</span> Heatmaps</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">36</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">37</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">38</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">39</span> Directory interactions</a></li>
<li><a class="" href="r-markdown-1.html"><span class="header-section-number">40</span> R Markdown</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">41</span> Routine reports</a></li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">42</span> Errors &amp; warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">43</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">44</span> Relational databases</a></li>
<li><a class="" href="shiny-and-dashboards.html"><span class="header-section-number">45</span> Shiny and dashboards</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">47</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">48</span> R on network drives</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot-tips" class="section level1" number="27">
<h1>
<span class="header-section-number">27</span> ggplot tips<a class="anchor" aria-label="anchor" href="#ggplot-tips"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-12" class="section level2" number="27.1">
<h2>
<span class="header-section-number">27.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-12"><i class="fas fa-link"></i></a>
</h2>
<p><code>ggplot2</code> is the most popular data visualisation package in R, and is generally used instead of base <code>R</code> for creating figures. <code>ggplot2</code> benefits from a wide variety of supplementary packages that further enhance its functionality. Despite this, ggplot syntax is significantly different from base <code>R</code> plotting, and has a learning curve associated with it. Using <code>ggplot2</code> generally requires the user to format their data in a way that is highly <code>tidyverse</code> compatible, which ultimately makes using these packages together very effective.</p>
<!-- One of the best resources is the official ggplot cheatsheet, shown here: -->
<!-- ```{r, include=TRUE, fig.align="center", fig.cap=c("ggplot cheatsheet"), echo=FALSE} -->
<!-- knitr::include_graphics("./images/imagename.pdf") -->
<!-- ``` -->
<!-- ``` -->
<p>You can also download this <a href="https://rstudio.com/resources/cheatsheets/">data visualization with ggplot cheatsheet</a> from the RStudio website.</p>
<p>If you want inspiration for ways to creatively visualise your data, we suggest reviewing websites like the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> and <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-16" class="section level2" number="27.2">
<h2>
<span class="header-section-number">27.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-16"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-6" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-6"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1084"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># includes ggplot2 and other</span>
  <span class="va">rio</span>,            <span class="co"># import/export</span>
  <span class="va">here</span>,           <span class="co"># file locator</span>
  <span class="va">stringr</span>,        <span class="co"># working with characters   </span>
  <span class="va">scales</span>,         <span class="co"># transform numbers</span>
  <span class="va">ggrepel</span>,        <span class="co"># smartly-placed labels</span>
  <span class="va">gghighlight</span>,    <span class="co"># highlight one part of plot</span>
  <span class="va">RColorBrewer</span>    <span class="co"># color scales</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="load-data-5" class="section level3 unnumbered">
<h3>Load data<a class="anchor" aria-label="anchor" href="#load-data-5"><i class="fas fa-link"></i></a>
</h3>
<p>Lets start by reading in the linelist data we will use for most of this page:</p>
<div class="sourceCode" id="cb1085"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_cleaned</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
</div>
<div id="general-cleaning" class="section level3 unnumbered">
<h3>General cleaning<a class="anchor" aria-label="anchor" href="#general-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>When preparing data to plot, it is best to make the data adhere to <a href="https://r4ds.had.co.nz/tidy-data.html">“tidy” data standards</a> as much as possible. How to achieve this is expanded on in the data management pages of this handbook, such as <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Cleaning data and core functions</a>.</p>
<p>Some simple ways we can prepare our data to make it better for plotting can often include making the contents of the data better for display - this does not necessarily mean its better for data manipulation! For example, we can replace <code>NA</code> values in a character column with the string “Unknown”, or clean some variables so that their “data friendly” with underscores etc are changed to normal text. Here are some examples of this in action:</p>
<div class="sourceCode" id="cb1086"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_cleaned</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
  <span class="co"># make display version of columns with more friendly names</span>
  <span class="fu">mutate</span><span class="op">(</span>
    <span class="co"># f to Male, f to Female, NA to Unknown</span>
    gender_disp <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="st">"Male"</span>,
                            <span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">~</span> <span class="st">"Female"</span>,
                            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unknown"</span><span class="op">)</span>,
    <span class="co"># replace NA with unknown for outcome</span>
    outcome_disp <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="pivoting-longer" class="section level3 unnumbered">
<h3>Pivoting longer<a class="anchor" aria-label="anchor" href="#pivoting-longer"><i class="fas fa-link"></i></a>
</h3>
<p>As a matter of data structure, we often also want to pivot our data into <em>longer</em> formats, which will allow us to use a set of variables as a single variable. Read more about this is the page on <a href="pivoting-data.html#pivoting-data">Pivoting data</a>.</p>
<p>For example, if we wanted to show the number of cases with specific symptoms, we are limited by the fact that each symptom is a specific column. We can pivot this to a longer format like this:</p>
<div class="sourceCode" id="cb1087"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_sym</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fever"</span>, <span class="st">"chills"</span>, <span class="st">"cough"</span>, <span class="st">"aches"</span>, <span class="st">"vomit"</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,
               values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that this format is not very useful for other operations, and should just be used for the plot it was made for. However, users should endeavor to use these practices as much as possible for the base dataset, as they are more tidyverse compliant, and will make working with the data easier.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="basics-of-ggplot" class="section level2" number="27.3">
<h2>
<span class="header-section-number">27.3</span> Basics of ggplot<a class="anchor" aria-label="anchor" href="#basics-of-ggplot"><i class="fas fa-link"></i></a>
</h2>
<p><strong>“Grammar of graphics” - ggplot2</strong></p>
<p>Plotting with <strong>ggplot2</strong> is based on defining base attributes to a plot, and “adding” layers on top. In addition, the user can change various plot attributes like axis settings, colour schemes, and labels with additional objects that are “added” to the plot. While ggplot objects can be highly complex, the basic order of creating a ggplot looks something like this:</p>
<ol style="list-style-type: decimal">
<li>Define base/default plot attributes and aesthetics with <code>ggplot()</code> function</li>
<li>Add geometric objects to the plot - i.e. is the plot a bar graph, a line plot, a scatter plot, or a histogram? Or is it a combination of these? These functions all start with <code>geom_</code> as a prefix.</li>
<li>Change plot aesthetics e.g. changing the axes, labels, colour scheme, background etc.</li>
</ol>
<p>In code, this might look like this:</p>
<div class="sourceCode" id="cb1088"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define base plot attributes and dataset</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add a geometric object with some parameters</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span>, fill <span class="op">=</span> <span class="st">"red"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add labels to the axes</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age in years"</span>, y <span class="op">=</span> <span class="st">"Number of cases"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-749-1.png" width="672"></div>
<p>With this code, the most important things to note are:</p>
<ol style="list-style-type: decimal">
<li>When making a ggplot, all objects are combined with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign.</li>
<li>Understand the principles behind aesthetic mapping with the <code>mappping = aes()</code> argument is essential to using ggplot. This can be done in the <code>ggplot()</code> function as well as every geometric object. Mapping with <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> is used to define which variables are assigned to each axis (these can be continuous or categorical variables). It is also used to define whether a variable can be used to create different plot aesthetics. This can apply to the:</li>
</ol>
<pre><code>a. line colour (`col = `)
b. filled colour (`fill = `)
c. linetype (e.g. dotted, dashed) (`linetype =`)
d. size of an object (`size = `)</code></pre>
<p>This list is not exhaustive, but is enough to give a rough overview.</p>
<ol start="3" style="list-style-type: decimal">
<li>Aesthetics of geometric objects can be defined <em>explicitly</em> as in the code above - this is different from assigning them to a variable. In cases where this is done, it must be <em>outside</em> the <code>mapping</code> argument.</li>
</ol>
<div class="sourceCode" id="cb1090"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># correct</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>

<span class="co"># incorrect</span>
<span class="co"># correct</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>An example of defining aesthetics with a variable can be seen here:</p>
<div class="sourceCode" id="cb1091"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in dataset</span>

<span class="co"># define base plot attributes and dataset</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add a geometric object with some parameters (NO FILL GIVEN)</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add labels to the axes</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age in years"</span>, y <span class="op">=</span> <span class="st">"Number of cases"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 87 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-751-1.png" width="672"></div>
<p>There are a huge number of different geoms that can be used, and they are all used with similar attribute names. While not exhaustive, some of the shapes that can be used are:</p>
<ol style="list-style-type: decimal">
<li>Histograms - <code>geom_histogram()</code>
</li>
<li>Barcharts - <code>geom_bar()</code>
</li>
<li>Boxplots - <code>geom_boxplot()</code>
</li>
<li>Dot plots (for scatterplots or with discrete variables) - <code>geom_point()</code>
</li>
<li>Line graphs - <code>geom_line()</code> or <code>geom_path()</code>
</li>
<li>Trend lines - <code>geom_smooth()</code>
</li>
</ol>
<p>You can also add straight lines to your plot with <code>geom_hline()</code> (horizontal), <code>geom_vline()</code> (vertical) or <code>geom_abline()</code> (with a specified y intercept and slope)</p>
<p>There is much more detail we could show here, but we’ll finish with an example that ties these concepts together by plotting a correlation between height and weight of all the patients. We can also colour the points by age in years</p>
<div class="sourceCode" id="cb1093"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set up the plot and define key variables</span>
<span class="co"># colour is the outcome</span>
<span class="va">wt_ht_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span>,
                     <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">ht_cm</span>, col <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># define aspects of the geom that are NOT included specific to variables</span>
  <span class="co"># other attributes are inherited</span>
  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add a trend line</span>
  <span class="co"># use a linear method</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span>
<span class="va">wt_ht_plot</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-752-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="themes-and-labels" class="section level2" number="27.4">
<h2>
<span class="header-section-number">27.4</span> Themes and Labels<a class="anchor" aria-label="anchor" href="#themes-and-labels"><i class="fas fa-link"></i></a>
</h2>
<p>One of the most important aspects of data visualisation is presenting data in a clear way with nice aesthetics. The plot we made previously looks ok, but we could make the theme a little nicer. <code>ggplot2</code> comes with some preset themes that can be used to change the theme of the plot. We can also edit themes of the plot with extreme detail with the <code>theme()</code> function. We can also add some nicer labels to the plot with the <code>labs()</code> function. There are 5 standard labeling locations:</p>
<ol style="list-style-type: decimal">
<li>
<code>x</code> - the x-axis</li>
<li>
<code>y</code> - the y-axis</li>
<li>
<code>title</code> - the main plot title</li>
<li>
<code>subtitle</code> - directly underneath the plot title in smaller text (by default)</li>
<li>
<code>caption</code> - bottom of plot, on the right by default</li>
</ol>
<p>For example, we can update the plot we previously plotted with nice labels like this:</p>
<div class="sourceCode" id="cb1095"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wt_ht_plot</span> <span class="op">&lt;-</span> <span class="va">wt_ht_plot</span> <span class="op">+</span> 
  <span class="co"># set the theme to classic</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># further edit the theme to move the legend position</span>
  <span class="co"># add nicer labels</span>
  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Weight (kg)"</span>, 
       x <span class="op">=</span> <span class="st">"height (cm)"</span>,
       title <span class="op">=</span> <span class="st">"Patient height and weight"</span>,
       subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"total patients {nrow(linelist_cleaned)}"</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="st">"produced by me!"</span><span class="op">)</span>
<span class="va">wt_ht_plot</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-753-1.png" width="672"></div>
<p>The <code>theme()</code> function can also be used to edit the defaults of these elements. This function can take an extremely large number of arguments, each of which can be used to edit very specific aspects of the plot. We won’t go through all examples, look at how editing aspects of text elements is done. The basic way this is done is:</p>
<ol style="list-style-type: decimal">
<li>Calling the specific argument of <code>theme()</code> for the element we want to edit (e.g. <code>plot.title</code> for the plot title)</li>
<li>Supplying the <code>element_text()</code> function to the argument (there are other versions of this e.g. <code>element_rect()</code> for editing the plot background aesthetics)</li>
<li>Changing the arguments in <code>element_text()</code>
</li>
</ol>
<p>For example, we increase the size of the plot title with <code>size</code>, make the subtitle italicised with <code>face</code>, and right
justify the caption with <code>hjust</code>. We’ll also change the legend location for good measure!</p>
<div class="sourceCode" id="cb1097"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wt_ht_plot</span> <span class="op">+</span> 
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
          <span class="co"># size of title is 30</span>
          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,
          <span class="co"># right justify caption</span>
          plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
          <span class="co"># subtitle is italicised</span>
          plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-754-1.png" width="672"></div>
<p>If you ever want to remove an element of a plot, you can also do it through <code>theme()</code>! Just pass <code>element_blank()</code> to an argument in theme to have it disappear completely!</p>
<!-- ======================================================= -->
</div>
<div id="colour-schemes" class="section level2" number="27.5">
<h2>
<span class="header-section-number">27.5</span> Colour schemes<a class="anchor" aria-label="anchor" href="#colour-schemes"><i class="fas fa-link"></i></a>
</h2>
<p>One thing that can initially be difficult to understand with <code>ggplot2</code> is control of colour schemes when passing colour or fill as a variable rather than defining them explicitly within a geom. There are a few simple tricks that can be used to achieve this however. Remember that when setting colours, you can use colour names (as long as they are recognised) like <code>"red"</code>, or a specific hex colour such as <code>"#ff0505"</code>.</p>
<p>One of the most useful tricks is using manual scaling functions to explicity define colours. These are functions with the syntax <code>scale_xxx_manual()</code> (e.g. <code>scale_colour_manual()</code>). In this function you can explicitly define which colours map to which factor using the <code>values</code> argument. You can control the legend title with the <code>name</code> argument, and the order of factors with <code>breaks</code>.</p>
<p>If you want predefined palettes, you can use the <code>scale_xxx_brewer</code> or <code>scale_xxx_viridis_y</code> functions. The brewer functions can draw from colorbrewer.org palettes, and the viridis functions can draw from viridis (colourblind friendly!) palettes. Remember to define if the palette is discrete, continuous, or binned by specifying this at the end of the function (e.g. discrete is <code>scale_xxx_viridis_d</code>)</p>
<p>We can see this by using the symptom-specific dataframe we made in the previous section:</p>
<div class="sourceCode" id="cb1099"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_sym</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># show as a portion of all</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Symptom"</span>,
    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span>
  <span class="op">)</span>

<span class="va">symp_plot</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-755-1.png" width="672"></div>
<div class="sourceCode" id="cb1100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symp_plot</span> <span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    <span class="co"># explicitly define colours</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span> <span class="op">=</span> <span class="st">"black"</span>,
               <span class="st">"no"</span> <span class="op">=</span> <span class="st">"white"</span>,
               <span class="st">"unknown"</span> <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    <span class="co"># order the factors correctly</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>,
    <span class="co"># legend has no title</span>
    name <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-755-2.png" width="672"></div>
<div class="sourceCode" id="cb1101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symp_plot</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>,
    name <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-755-3.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="change-order-of-discrete-variables" class="section level2" number="27.6">
<h2>
<span class="header-section-number">27.6</span> Change order of discrete variables<a class="anchor" aria-label="anchor" href="#change-order-of-discrete-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Changing the order that discrete variables appear in is often difficult to understand for people who are new to <code>ggplot2</code> graphs. It’s easy to understand how to do this however once you understand how <code>ggplot2</code> handles discrete variables under the hood. Generally speaking, if a discrete varaible is used, it is automatically converted to a <code>factor</code> type - which orders factors by alphabetical order by default. To handle this, you simply have to reorder the factor levels to reflect the order you would like them to appear in the chart. For more detailed information on how to reorder <code>factor</code> objects, see the factor section of the guide.</p>
<p>We can look at a common example using age groups - by default the 5-9 age group will be placed in the middle of the age groups (given alphabetical order), but we can move it behind the 0-4 age group of the chart by releveling the factors.</p>
<div class="sourceCode" id="cb1102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove the instances of age_cat5 where data is missing</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_cat5</span><span class="op">)</span><span class="op">)</span>,
       <span class="co"># relevel the factor within the ggplot call (can do externally as well)</span>
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"5-9"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age group"</span>, y <span class="op">=</span> <span class="st">"Number of hospitalisations"</span>,
       title <span class="op">=</span> <span class="st">"Total hospitalisations by age group"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-756-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="multiple-plots" class="section level2" number="27.7">
<h2>
<span class="header-section-number">27.7</span> Multiple plots<a class="anchor" aria-label="anchor" href="#multiple-plots"><i class="fas fa-link"></i></a>
</h2>
<p>Often its useful to show multiple graphs on one page, or one super-figure. There are a few ways to achieve this and a lot of packages that can help to facilitate it. However, while external packages are nice, it is often easier to use faceting as an alternative that is prebuilt into <code>ggplot2</code>. Faceting plots is extremely easy to do in terms of code, and produces plots with more predictable aesthetics - you wont have to wrangle legends and ensure that axes are aligned etc.</p>
<p>Faceting is a very specific way to obtain multiple plots - by definition, to facet you have to show the same type of plot in each facet, where every plot is specific to a level of a variable. This is done with one of two functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>facet_wrap()</code> This is used when you want to show a different graph for each level of a <em>single</em> variable. One example of this could be showing a different epidemic curve for each hospital in a region.</p></li>
<li><p><code>facet_grid()</code> This is used when you want to bring a second variable into the faceting arrangement. Here each element of a grid is shows the intersection between an x or y element of a grid. For example, this could involve showing a different epidemic curve for each hospital in a region, shown horizontally, for each age group, shown vertically.</p></li>
</ol>
<p>This can quickly become an overwhelming amount of information - its good to ensure you don’t have too many levels of each variable that you choose to facet by! Here are some quick examples with the malaria dataset:</p>
<div class="sourceCode" id="cb1103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># show a wrapped plot with facets by district</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span>, fill <span class="op">=</span> <span class="va">District</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"date of data collection"</span>,
    y <span class="op">=</span> <span class="st">"malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-757-1.png" width="672"></div>
<p>We can also use a <code>facet_grid()</code> approach with the different age groups - we need to do some data transformations first however, as the age groups all are in their own columns - we want them in a single column. When you pass the two variables to <code>facet_grid()</code>, you can use formula notation (e.g. <code>x ~ y</code>) or wrap the variables in <code>vars()</code>. For reference, this: <code>facet_grid(x ~ y)</code> is equivalent to <code>facet_grid(rows = vars(x), cols = vars(y))</code> Here’s how we can do this:</p>
<div class="sourceCode" id="cb1104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_age</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    <span class="co"># choose all the columns that start with malaria rdt (age group specific)</span>
    cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"malaria_rdt_"</span><span class="op">)</span>,
    <span class="co"># column names become age group</span>
    names_to <span class="op">=</span> <span class="st">"age_group"</span>,
    <span class="co"># values to a single column (num_cases)</span>
    values_to <span class="op">=</span> <span class="st">"num_cases"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># clean up age group column - replace "malaria_rdt_" to leave only age group</span>
  <span class="co"># then replace 15 with 15+</span>
  <span class="co"># then refactor the age groups so they are in order</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">.</span> <span class="op">==</span> <span class="st">"15"</span>, <span class="st">"15+"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"5-14"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>


<span class="co"># make the same plot as before, but show in a grid</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_age</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">num_cases</span>, fill <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"date of data collection"</span>,
    y <span class="op">=</span> <span class="st">"malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district and age group"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">District</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-758-1.png" width="672"></div>
<p>While faceting is a convenient approach to plotting, sometimes its not possible to get the results you want from its relatively restrictive approach. Here, you may choose to combine plots by sticking them together into a larger plot. There are three well known packages that are great for this - <code>cowplot</code>, <code>gridExtra</code>, and <code>patchwork</code>. However, these packages largely do the same things, so we’ll focus on <code>cowplot</code> for this section.</p>
<p>The <code>cowplot</code> package has a fairly wide range of functions, but the easiest use of it can be achieved through the use of <code>plot_grid()</code>. This is effectively a way to arrange predefined plots in a grid formation. We can work through another example with the malaria dataset - here we can plot the total cases by district, and also show the epidemic curve over time.</p>
<div class="sourceCode" id="cb1105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># bar chart of total cases by district</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">District</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"District"</span>,
    y <span class="op">=</span> <span class="st">"Total number of cases"</span>,
    title <span class="op">=</span> <span class="st">"Total malaria cases by district"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>

<span class="co"># epidemic curve over time</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Date of data submission"</span>,
    y <span class="op">=</span>  <span class="st">"number of cases"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>

<span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>,
                  <span class="co"># 1 column and two rows - stacked on top of each other</span>
                   ncol <span class="op">=</span> <span class="fl">1</span>,
                   nrow <span class="op">=</span> <span class="fl">2</span>,
                   <span class="co"># top plot is 2/3 as tall as second</span>
                   rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-759-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="smart-labeling" class="section level2" number="27.8">
<h2>
<span class="header-section-number">27.8</span> Smart Labeling<a class="anchor" aria-label="anchor" href="#smart-labeling"><i class="fas fa-link"></i></a>
</h2>
<p>In <code>ggplot2</code>, it is also possible to add text to plots. However, this comes with the notable limitation where text labels often clash with data points in a plot, making them look messy or hard to read. There is no ideal way to deal with this in the base package, but there is a <code>ggplot2</code> addon, known as <code>ggrepel</code> that makes dealing with this very simple!</p>
<p>The <code>ggrepel</code> package provides two new functions, <code>geom_label_repel()</code> and <code>and geom_text_repel()</code>, which replace <code>geom_label()</code> and <code>geom_text()</code>. Simply use these functions instead of the base functions to produce neat labels. You can also use the <code>force</code> argument to change the degree of repulsion between labels and their respective points.</p>
<p>For our example, we will make a scatterplot showing height against weight again. We’re also going to label each point with a patient id when the patient is over 70 years of age. We’ll use a trick with filter to only show these specific points!</p>
<div class="sourceCode" id="cb1106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggrepel</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_cleaned</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ht_cm</span>,
           y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># pass the filtered version of the dataset as a new dataset</span>
  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">age_years</span> <span class="op">&gt;</span> <span class="fl">70</span><span class="op">)</span>,
                           <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">case_id</span><span class="op">)</span>,
                           force <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"weight (kg)"</span>, x <span class="op">=</span> <span class="st">"height(cm)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-760-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="time-axes" class="section level2" number="27.9">
<h2>
<span class="header-section-number">27.9</span> Time axes<a class="anchor" aria-label="anchor" href="#time-axes"><i class="fas fa-link"></i></a>
</h2>
<p>Working with time axes in ggplot can seem daunting, but is made very easy with a few key functions. Remember that when working with time or date that you should ensure that the correct variables are formatted as date or datetime class - see the <em>working with dates</em> section for more information on this.</p>
<p>The single most useful set of functions for working with dates in <code>ggplot2</code> are the scale functions (<code>scale_x_date()</code>, <code>scale_x_datetime()</code>, and their cognate y-axis functions). These functions let you define how often you have axis labels, and how to format axis labels. To find out how to format dates, see the <em>working with dates</em> section again! You can use the <code>date_breaks</code> and <code>date_labels</code> arguments to specify how dates should look:</p>
<ol style="list-style-type: decimal">
<li><p><code>date_breaks</code> allows you to specify how often axis breaks occur - you can pass a string here (e.g. <code>"3 months"</code>, or "<code>2 days"</code>)</p></li>
<li><p><code>date_labels</code> allows you to define the format dates are shown in. You can pass a date format string to these arguments (e.g. <code>"%b-%d-%Y"</code>):</p></li>
</ol>
<div class="sourceCode" id="cb1107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make epi curve by date of onset when available</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_cleaned</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    <span class="co"># 1 break every 1 month</span>
    date_breaks <span class="op">=</span> <span class="st">"1 months"</span>,
    <span class="co"># labels should show month then date</span>
    date_labels <span class="op">=</span> <span class="st">"%b %d"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-761-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="highlighting" class="section level2" number="27.10">
<h2>
<span class="header-section-number">27.10</span> Highlighting<a class="anchor" aria-label="anchor" href="#highlighting"><i class="fas fa-link"></i></a>
</h2>
<p>Highlighting specific elements in a chart is a useful way to draw attention to a specific instance of a variable while also providing information on the dispersion of the full dataset. While this is not easily done in base <code>ggplot2</code>, there is an external package that can help to do this known as <code>gghighlight</code>. This is easy to use within the ggplot syntax.</p>
<p>The <code>gghighlight</code> package uses the <code><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight()</a></code> function to achieve this effect. To use this function, supply a logical statement to the function - this can have quite flexible outcomes, but here we’ll show an example of the age distribution of cases in our linelist, highlighting them by outcome.</p>
<div class="sourceCode" id="cb1108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load gghighlight</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yutannihilation/gghighlight/">gghighlight</a></span><span class="op">)</span>


<span class="co"># replace NA values with unknown in the outcome variable</span>
<span class="va">linelist_cleaned</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>outcome <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># produce a histogram of all cases by age</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_cleaned</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># highlight instances where the patient has died.</span>
  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-762-1.png" width="672"></div>
<p>This also works well with faceting functions - it allows the user to produce facet plots with the background data highlighted that doesn’t apply to the facet!</p>
<div class="sourceCode" id="cb1109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># produce a histogram of all cases by age</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist_cleaned</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># highlight instances where the patient has died.</span>
  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">outcome</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-763-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="dual-axes" class="section level2" number="27.11">
<h2>
<span class="header-section-number">27.11</span> Dual axes<a class="anchor" aria-label="anchor" href="#dual-axes"><i class="fas fa-link"></i></a>
</h2>
<p>A secondary y-axis is often a requested addition to a <code>ggplot2</code> graph. While there is a robust debate about the validity of such graphs in the data visualization community, and they are often not recommended, your manager may still want them. Below, we present two methods to achieve them.</p>
<ol style="list-style-type: decimal">
<li>Using the <strong>cowplot</strong> package to combine two separate plots<br>
</li>
<li>Using a statistical transformation of the data on the primary axis</li>
</ol>
<div id="using-cowplot" class="section level3 unnumbered">
<h3>Using <strong>cowplot</strong><a class="anchor" aria-label="anchor" href="#using-cowplot"><i class="fas fa-link"></i></a>
</h3>
<p>This approach involves creating two separate plots - one with a y-axis on the left, and the other with y-axis on the right. Both will use a specific <code>theme_cowplot()</code> and must have the same x-axis. Then in a third command the two plots are aligned and overlaid on top of each other. The functionalities of <strong>cowplot</strong>, of which this is only one, are described in depth at this <a href="https://wilkelab.org/cowplot/articles/aligning_plots.html">site</a>.</p>
<p>To demonstrate this technique we will overlay the epidemic curve with a line of the weekly percent of patients who died. We use this example because the alignment of dates on the x-axis is more complex than say, aligning a bar chart with another plot. Some things to note:</p>
<ul>
<li>The epicurve and the line are aggregated into weeks prior to plotting <em>and</em> the <code>date_breaks</code> and <code>date_labels</code> are identical - we do this so that the x-axes of the two plots are the same when they are overlaid.<br>
</li>
<li>The y-axis is moved to the right-side for plot 2 with the <code>position =</code> argument of <code>scale_y_continuous()</code>.<br>
</li>
<li>Both plots make use of <code>theme_cowplot()</code>
</li>
</ul>
<p>Note there is another example of this technique in the [Epicurves] page - overlaying cumulative incidence on top of the epicurve.</p>
<p><strong>Make plot 1</strong><br>
This is essentially the epicurve. We use <code>geom_area()</code> just to demonstrate its use (area under a line, by default)</p>
<div class="sourceCode" id="cb1110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>            <span class="co"># load/install cowplot</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                 <span class="co"># save plot as object</span>
     <span class="fu">count</span><span class="op">(</span>
       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">geom_area</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">scale_x_date</span><span class="op">(</span>
               date_breaks <span class="op">=</span> <span class="st">"month"</span>,
               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">labs</span><span class="op">(</span>
       y <span class="op">=</span> <span class="st">"Weekly cases"</span>
     <span class="op">)</span>

<span class="va">p1</span>                                      <span class="co"># view plot </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-764-1.png" width="672"></div>
<p><strong>Make plot 2</strong><br>
Create the second plot showing a line of the weekly percent of cases who died.</p>
<div class="sourceCode" id="cb1111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>         <span class="co"># save plot as object</span>
     <span class="fu">group_by</span><span class="op">(</span>
       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="fu">summarise</span><span class="op">(</span>
       n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
       pct_death <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">pct_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">scale_x_date</span><span class="op">(</span>
               date_breaks <span class="op">=</span> <span class="st">"month"</span>,
               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">scale_y_continuous</span><span class="op">(</span>
               position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
          <span class="fu">labs</span><span class="op">(</span>
            x <span class="op">=</span> <span class="st">"Epiweek of symptom onset"</span>,
            y <span class="op">=</span> <span class="st">"Weekly percent of deaths"</span>,
            title <span class="op">=</span> <span class="st">"Weekly case incidence and percent deaths"</span>
          <span class="op">)</span>

<span class="va">p2</span>     <span class="co"># view plot</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-765-1.png" width="672"></div>
<p>Now we align the plot using the function <code>align_plots()</code>, specifying horizontal and vertical alignment (“hv”, could also be “h”, “v”, “none”). We specify alignment of all axes as well (top, bottom, left, and right) with “tblr”. The output is of class list (2 elements).</p>
<p>Then we draw the two plots together using <code>ggdraw()</code> (from <strong>cowplot</strong>) and referencing the two parts of the <code>aligned_plots</code> object.</p>
<div class="sourceCode" id="cb1112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">align_plots</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>                  <span class="co"># align the two plots and save them as list</span>
<span class="va">aligned_plotted</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># overlay them and save the visual plot</span>
<span class="va">aligned_plotted</span>                                                                <span class="co"># print the overlayed plots</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-766-1.png" width="672"></div>
</div>
<div id="statistical-transformation" class="section level3 unnumbered">
<h3>Statistical transformation<a class="anchor" aria-label="anchor" href="#statistical-transformation"><i class="fas fa-link"></i></a>
</h3>
<p>Unfortunately, secondary axes are not well supported in the <code>ggplot</code> syntax. For this reason, you’re fairly limited in terms of what can be shown with a secondary axis - the second axis has to be a direct transformation of the secondary axis.</p>
<p>Differences in axis values will be purely cosmetic - if you want to show two different variables on one graph, with different y-axis scales for each variable, this will not work without some work behind the scenes. To obtain this effect, you will have to transform one of your variables in the data, and apply the same transformation <em>in reverse</em> when specifying the axis labels. Based on this, you can either specify the transformation explicitly (e.g. variable a is around 10x as large as variable b) or calculate it in the code (e.g. what is the ratio between the maximum values of each dataset).</p>
<p>The syntax for adding a secondary axis is very straightforward! When calling a <code>scale_xxx_xxx()</code> function (e.g. <code>scale_y_continuous()</code>), use the <code>sec.axis</code> argument to call the <code>sec_axis()</code> function. The <code>trans</code> argument in this function allows you to specify the label transformation for the axis - provide this in standard tidyverse syntax.</p>
<p>For example, if we want to show the number of positive RDTs in the malaria dataset for facility 1, showing 0-4 year olds and all cases on chart:</p>
<div class="sourceCode" id="cb1113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># take malaria data from facility 1</span>
<span class="va">malaria_facility_1</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">location_name</span> <span class="op">==</span> <span class="st">"Facility 1"</span><span class="op">)</span>

<span class="co"># calculate the ratio between malaria_rdt_0-4 and malaria_tot </span>

<span class="va">tf_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">malaria_facility_1</span><span class="op">$</span><span class="va">malaria_tot</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">malaria_facility_1</span><span class="op">$</span><span class="va">`malaria_rdt_0-4`</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co"># transform the values in the dataset</span>

<span class="va">malaria_facility_1</span> <span class="op">&lt;-</span> <span class="va">malaria_facility_1</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>malaria_rdt_0_4_tf <span class="op">=</span> <span class="va">`malaria_rdt_0-4`</span> <span class="op">*</span> <span class="va">tf_ratio</span><span class="op">)</span>
  

<span class="co"># plot the graph with dual axes</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_facility_1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">malaria_tot</span>, col <span class="op">=</span> <span class="st">"Total cases"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">malaria_rdt_0_4_tf</span>, col <span class="op">=</span> <span class="st">"Cases: 0-4 years old"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"Total cases"</span>,
    sec.axis <span class="op">=</span> <span class="fu">sec_axis</span><span class="op">(</span>trans <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">/</span> <span class="va">tf_ratio</span>, name <span class="op">=</span> <span class="st">"Cases: 0-4 years old"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"date of data collection"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-767-1.png" width="672"></div>
</div>
</div>
<div id="miscellaneous" class="section level2" number="27.12">
<h2>
<span class="header-section-number">27.12</span> Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"><i class="fas fa-link"></i></a>
</h2>
<div id="numeric-display" class="section level3 unnumbered">
<h3>Numeric display<a class="anchor" aria-label="anchor" href="#numeric-display"><i class="fas fa-link"></i></a>
</h3>
<p>You can disable scientific notation by running this command prior to plotting.</p>
<div class="sourceCode" id="cb1114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen<span class="op">=</span><span class="fl">999</span><span class="op">)</span></code></pre></div>
<p>Or apply <code>number_format()</code> from the <strong>scales</strong> package to a specific value or column, as shown below.</p>
<p>Use functions from the package <strong>scales</strong> to easily adjust how numbers are displayed. These can be applied to columns in your data frame, but are shown on individual numbers for purpose of example.</p>
<div class="sourceCode" id="cb1115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/number.html">number</a></span><span class="op">(</span><span class="fl">6.2e5</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "620 000"</code></pre>
<div class="sourceCode" id="cb1117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/number.html">number</a></span><span class="op">(</span><span class="fl">1506800.62</span>,  accuracy <span class="op">=</span> <span class="fl">0.1</span>,<span class="op">)</span></code></pre></div>
<pre><code>## [1] "1 506 800.6"</code></pre>
<div class="sourceCode" id="cb1119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_number.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1,506,800.62"</code></pre>
<div class="sourceCode" id="cb1121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_number.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span>,  big.mark <span class="op">=</span> <span class="st">"."</span> , decimal.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1.506.800,62"</code></pre>
<div class="sourceCode" id="cb1123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_percent.html">percent</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "10%"</code></pre>
<div class="sourceCode" id="cb1125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_dollar.html">dollar</a></span><span class="op">(</span><span class="fl">56</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "$56"</code></pre>
<div class="sourceCode" id="cb1127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_scientific.html">scientific</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1e+05"</code></pre>
</div>
</div>
<div id="resources-20" class="section level2" number="27.13">
<h2>
<span class="header-section-number">27.13</span> Resources<a class="anchor" aria-label="anchor" href="#resources-20"><i class="fas fa-link"></i></a>
</h2>
<p>Inspiration
<a href="https://www.tidyverse.org/blog/2018/07/ggplot2-3-0-0/">ggplot graph gallery</a></p>
<p>Facets and labellers
<a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/#modifying-facet-label-text">Using labellers for facet strips</a>
<a href="https://ggplot2.tidyverse.org/reference/labellers.html">Labellers</a></p>
<p>Adjusting order with factors
<a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a><br><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a><br><a href="https://cmdlinetips.com/2019/02/how-to-reorder-a-boxplot-in-r/">How to reorder a boxplot</a><br><a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html">Reorder a variable in ggplot2</a><br><a href="https://r4ds.had.co.nz/factors.html">R for Data Science - Factors</a></p>
<p>Legends<br><a href="https://stackoverflow.com/questions/38425908/reverse-stacking-order-without-affecting-legend-order-in-ggplot2-bar-charts">Adjust legend order</a></p>
<p>Captions
<a href="https://stackoverflow.com/questions/64701500/left-align-ggplot-caption">Caption alignment</a></p>
<p>Cheatsheets<br><a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/">Beautiful plotting with ggplot2</a></p>
<p>TO DO - Under construction</p>
<p>Using option <code>label_wrap_gen</code> in facet_wrap to have multiple strip lines
labels and colors of strips</p>
<p>Axis text vertical adjustment
rotation
Labellers</p>
<p>limit range with limit() and coord_cartesian(), ylim(), or scale_x_continuous()
theme_classic()</p>
<p>expand = c(0,0)
coord_flip()
tick marks</p>
<p>ggrepel
animations</p>
<p>remove
remove title
using fill = or color = in labs()
flip order / don’t flip order
move location
color? theme(legend.title = element_text(colour=“chocolate”, size=16, face=“bold”))+ scale_color_discrete(name=“This color ischocolate!?”)
Color of boxes behind points in legend
theme(legend.key=element_rect(fill=‘pink’)) or use fill = NA to remove them. <a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/" class="uri">http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/</a>
Change size of symbols in legend only guides(colour = guide_legend(override.aes = list(size=4)))</p>
<p>Turn off a layer in the legend
geom_text(data=nmmaps, aes(date, temp, label=round(temp)), size=4)
geom_text(data=nmmaps, aes(date, temp, label=round(temp), size=4), show_guide=FALSE)</p>
<p>Force a legend even if there is no aes().
ggplot(nmmaps, aes(x=date, y=o3))+
geom_line(aes(color=“Important line”))+
geom_point(aes(color=“My points”))
Control the shape in the legend with guides - a list with linetype and shape
ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color=“Important line”))+
geom_point(aes(color=“Point values”))+
scale_colour_manual(name=’‘, values=c(’Important line’=‘grey’, ‘Point values’=‘red’), guide=‘legend’) +
guides(colour = guide_legend(override.aes = list(linetype=c(1,0)
, shape=c(NA, 16))))</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="gis-basics.html"><span class="header-section-number">26</span> GIS basics</a></div>
<div class="next"><a href="epidemic-curves.html"><span class="header-section-number">28</span> Epidemic curves</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot-tips"><span class="header-section-number">27</span> ggplot tips</a></li>
<li><a class="nav-link" href="#overview-12"><span class="header-section-number">27.1</span> Overview</a></li>
<li>
<a class="nav-link" href="#preparation-16"><span class="header-section-number">27.2</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-6">Load packages</a></li>
<li><a class="nav-link" href="#load-data-5">Load data</a></li>
<li><a class="nav-link" href="#general-cleaning">General cleaning</a></li>
<li><a class="nav-link" href="#pivoting-longer">Pivoting longer</a></li>
</ul>
</li>
<li><a class="nav-link" href="#basics-of-ggplot"><span class="header-section-number">27.3</span> Basics of ggplot</a></li>
<li><a class="nav-link" href="#themes-and-labels"><span class="header-section-number">27.4</span> Themes and Labels</a></li>
<li><a class="nav-link" href="#colour-schemes"><span class="header-section-number">27.5</span> Colour schemes</a></li>
<li><a class="nav-link" href="#change-order-of-discrete-variables"><span class="header-section-number">27.6</span> Change order of discrete variables</a></li>
<li><a class="nav-link" href="#multiple-plots"><span class="header-section-number">27.7</span> Multiple plots</a></li>
<li><a class="nav-link" href="#smart-labeling"><span class="header-section-number">27.8</span> Smart Labeling</a></li>
<li><a class="nav-link" href="#time-axes"><span class="header-section-number">27.9</span> Time axes</a></li>
<li><a class="nav-link" href="#highlighting"><span class="header-section-number">27.10</span> Highlighting</a></li>
<li>
<a class="nav-link" href="#dual-axes"><span class="header-section-number">27.11</span> Dual axes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-cowplot">Using cowplot</a></li>
<li><a class="nav-link" href="#statistical-transformation">Statistical transformation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#miscellaneous"><span class="header-section-number">27.12</span> Miscellaneous</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#numeric-display">Numeric display</a></li></ul>
</li>
<li><a class="nav-link" href="#resources-20"><span class="header-section-number">27.13</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-03-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
